name: filebeat-specific
setup.ilm.enabled: false
setup.template.enabled: true
setup.template.overwrite: true
setup.template.name: 'docker-logs'
setup.template.pattern: 'docker-logs-*'

filebeat.inputs:
    - type: container
      logging:
          driver: 'local'
          options:
              max-size: '10m'
              max-file: '3'
      ignore_older: 24h # 24시간 이전에 수정된 파일은 무시
      processors:
          - add_docker_metadata: ~ # 도커 관련 메타데이터 수집: docker.sock 필요
          - drop_event:
                when:
                    or:
                        - not.equals.container.name: ${#__CONTAINER_NAME__#}
                        - not.contains.message: 'Chain head was updated'
      fields:
          container_type: docker
          environment: nitro-1
          team: devops
      paths:
          - '/var/lib/docker/containers/${#__CONTAINER_ID__#}/*.log'

output.elasticsearch:
    protocol: http
    hosts: ['${ELASTICSEARCH_HOST}']
    index: 'docker-logs-%{+yyyy.MM.dd}'
